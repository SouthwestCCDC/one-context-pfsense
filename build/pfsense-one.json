{
     "variables": {
       "iso": "pfsense.iso",
       "pfsense_version": "2.5.2"
     },
     "builders": [
          {
               "http_directory": "http",
               "http_port_min": "8100",
               "type": "qemu",
               "headless": "false",
               "boot_wait": "5s",
               "boot_steps": [
                    ["1<enter><wait45s>", "Boot into installer media..."],
                    ["<enter><wait3s>", "Accept installer terms."],
                    ["io<enter><wait5s>", "Select Install."],
                    ["<enter><wait>", "Set keyboard map."],
                    ["<down><enter>", "UFS with UEFI."],
                    ["<wait100s>", "Wait for installer to copy files..."],
                    ["n<wait>", "Don't drop into a root shell."],
                    ["r<wait60s>", "Rebooting..."],
                    ["n<enter><wait>", "No VLANs please."],
                    ["em0<enter><wait>", "WAN is em0."],
                    ["em1<enter><wait>", "LAN is em1."],
                    ["y<enter><wait>", "Write config."],
                    ["<wait75s>", "Wait for config to load..."],
                    ["8<enter>", "Go to shell"],
                    ["mount -t cd9660 /dev/cd1 /mnt<enter><wait2s>", "Mount the virtual CD"],
                    ["cp /mnt/one-context /usr/local/sbin/one-context<enter><wait>", "Copy one-context"],
                    ["chmod 755 /usr/local/sbin/one-context<enter><wait>", "chmod +x one-context"],
                    ["cp /mnt/one-context-install .<enter><wait>", "Copy one-context-install"],
                    ["chmod 755 one-context-install<enter><wait>", "chmod +x one-context-install"],
                    ["./one-context-install<enter><wait4s>", "Run one-context-install"],
                    ["shutdown -p now<enter>", "Shut down."]

               ],
               "qemuargs": [
                    ["-nic", "user,model=e1000"]
               ],
               "vm_name": "pfsense_{{ user `pfsense_version` }}.qcow2",
               "iso_url": "{{ user `iso` }}",
               "iso_checksum": "none",
               "communicator": "none",
               "format": "qcow2",
               "net_device": "e1000",
               "disk_size": "4096M",
               "memory": 2048,
               "cd_files": [
                    "../one-context",
                    "../one-context-install"
               ]
          }
     ],
     "provisioners": [
     ]
}
